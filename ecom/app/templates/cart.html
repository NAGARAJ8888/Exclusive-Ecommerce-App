{% extends 'base.html' %} {% load static %}{% load custom_filters %} {% block
content %}
<div class="mx-2 mb-2 md:mx-32 md:mb-20">
  <div class="my-4 md:my-20">
    <span class="text-sm"><span class="text-gray-500">Home</span> / Cart</span>
  </div>
  <div>
    <table class="w-full table-fixed border-collapse justify-between">
      <thead>
        <tr class="shadow-lg bg-white dark:text-black border-2 border-gray-100">
          <th
            class="text-left py-2 px-3 text-xs md:text-lg font-semibold md:py-4 md:px-6"
          >
            Product
          </th>
          <th
            class="text-center py-2 px-3 text-xs md:text-lg font-semibold md:py-4 md:px-6"
          >
            Price
          </th>
          <th
            class="text-center py-2 px-3 text-xs md:text-lg font-semibold md:py-4 md:px-6"
          >
            Quantity
          </th>
          <th
            class="text-center py-2 px-3 text-xs md:text-lg font-semibold md:py-4 md:px-6"
          >
            Subtotal
          </th>
          <th
            class="text-center py-2 px-3 text-xs md:text-lg font-semibold md:py-4 md:px-6"
          >
            Remove
          </th>
        </tr>
      </thead>
      <tbody>
        {% for item in cart_items %}
        <tr class="shadow-lg bg-white border-2 border-gray-100 dark:text-black">
          <td
            class="text-left py-2 px-3 text-xs md:text-lg font-semibold md:py-4 md:px-6"
          >
            <img
              src="{{ item.product.image.url }}"
              alt="image"
              class="object-contain size-3 md:size-5"
            />
            <span class="text-xs md:text-sm font-semibold"
              >{{ item.product.title }}</span
            >
          </td>
          <td
            class="text-center py-2 px-3 text-xs md:text-lg font-semibold md:py-4 md:px-6"
          >
            ₹{{ item.product.new_price }}
          </td>
          <td
            class="text-center py-2 px-3 text-xs md:text-lg font-semibold md:py-4 md:px-6"
          >
            <input
              type="number"
              value="{{ item.quantity }}"
              min="1"
              class="w-8 md:w-16 md:p-2 border-2 border-gray-400 rounded-md update-quantity"
              data-id="{{ item.id }}"
            />
          </td>
          <td
            class="text-center py-2 px-3 text-xs md:text-lg font-semibold md:py-4 md:px-6"
          >
            ₹{{ item.product.new_price|mul:item.quantity|floatformat:0 }}
          </td>
          <td
            class="text-center py-2 px-3 text-xs md:text-lg font-semibold md:py-4 md:px-6"
          >
            <form method="post" action="{% url 'remove_from_cart' item.id %}">
              {% csrf_token %}
              <button
                type="submit"
                class="text-red-600 hover:text-red-800 text-xl font-bold cursor-pointer"
              >
                &times;
              </button>
            </form>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="4" class="text-center py-6 text-gray-500">
            Your cart is empty.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <div class="flex justify-between my-2 md:my-8">
      <a
        href="{% url 'home' %}"
        class="border-2 border-gray-400 py-2 px-4 text-xs md:text-sm md:py-2 md:px-6 rounded-sm"
      >
        Return To Shop
      </a>
    </div>

    <div class="flex flex-col md:flex-row justify-between">
      <div class="min-w-1/3 my-4 md:my-0">
        <input
          type="text"
          placeholder="Enter Coupon Code"
          class="border-2 border-gray-400 py-2 px-4 text-xs md:text-sm md:py-2 md:px-6 w-1/2 rounded-sm"
        />
        <button
          class="text-white bg-red-400 py-2 px-4 text-xs md:text-sm md:py-2 md:px-6 ml-3 rounded-sm"
        >
          Apply Coupon
        </button>
      </div>
      <div class="min-w-1/3 border-2 border-gray-400 p-6 rounded-sm">
        <h1>Cart Total</h1>
        <div class="flex justify-between mt-4 border-b-2 border-gray-200 pb-2">
          <span>Subtotal</span>
          <span>₹{{ total }}</span>
        </div>
        <div class="flex justify-between mt-4 border-b-2 border-gray-200 pb-2">
          <span>Shipping</span>
          <span>Free</span>
        </div>
        <div class="flex justify-between mt-4 border-b-2 border-gray-200 pb-2">
          <span>Total</span>
          <span>₹{{ total }}</span>
        </div>
        <div class="flex justify-center mt-6">
          <a
            href="{% url 'checkout' %}"
            class="text-white bg-red-400 py-2 px-6 rounded-sm"
          >
            Proceed to checkout
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  document.querySelectorAll(".update-quantity").forEach((input) => {
    input.addEventListener("change", function () {
      const cartItemId = this.getAttribute("data-id");
      const newQuantity = this.value;

      fetch(`/update-cart-item/${cartItemId}/`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": "{{ csrf_token }}",
        },
        body: JSON.stringify({ quantity: newQuantity }),
      })
        .then((res) => res.json())
        .then((data) => {
          if (data.success) {
            location.reload(); // reload page to see updated subtotal and total
          } else {
            alert("Failed to update cart.");
          }
        });
    });
  });
</script>

{% endblock %}
